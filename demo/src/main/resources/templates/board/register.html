<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<div id="registerForm" layout:fragment="content" class="container-md mt-5">
    <h3>게시물 만들기</h3>
    <form action="/board/register" method="post" enctype="multipart/form-data">
        <div class="mb-3 mt-5">
            <label for="t" class="form-label"></label>
            <input type="text" name="title" class="form-control" id="t" placeholder="제목*">
        </div>

        <!-- TOAST UI -->
        <div class="mb-3">
            <label class="form-label"></label>
            <div id="editor"></div>
            <!-- 에디터 내용을 담을 hidden input -->
            <input type="hidden" name="content" id="content">
        </div>

        <div class="mb-3">
            <label for="w" class="form-label"></label>
            <input type="hidden" name="writer"
                   class="form-control" id="w" >
        </div>

        <button class="btn btn-primary" id="regBtn">게시하기</button>
    </form>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const Editor = toastui.Editor;
            const editor = new Editor({
                el: document.querySelector('#editor'),
                height: '600px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                hideModeSwitch: true,
                 hooks: {
                    addImageBlobHook: async (blob, callback) => {
                        // FormData로 이미지 업로드
                        const formData = new FormData();
                        formData.append('image', blob);

                        try {
                            const response = await fetch('/upload/image', {
                                method: 'POST',
                                body: formData
                            });
                            const data = await response.json();
                            // 업로드된 이미지 URL을 에디터에 삽입
                            callback(data.url, '이미지');
                        } catch (error) {
                            console.error('이미지 업로드 실패:', error);
                        }
                    }
                }
            });

             document.querySelector('#registerForm').addEventListener('submit', function(e) {
             document.querySelector('#content').value = editor.getHTML();
            });
        });
    </script>
</div>

