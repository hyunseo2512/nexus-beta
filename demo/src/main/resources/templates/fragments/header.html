<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<nav class="sb-topnav navbar navbar-expand bg-light" th:fragment="header">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" th:href="@{/}">
            <img th:src="@{/images/nexus_logo.png}" alt="Nexus Logo" width="40" height="40" class="me-2"
                style="border-radius: 50%; box-shadow: 0 0 10px rgba(157, 86, 255, 0.5);">
            <span
                style="font-weight: 700; font-size: 1.25rem; background: linear-gradient(135deg, #4DA9FF 0%, #9D56FF 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Nexus</span>
        </a>


        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <form class="d-flex mx-auto" role="search" style="max-width: 400px; width: 100%;" action="/" method="get">
                <div class="input-group custom-search-group shadow-sm"
                    style="border-radius: 50px; overflow: hidden; border: 1px solid rgba(157, 86, 255, 0.3);">
                    <button class="btn border-0" type="submit"
                        style="background: rgba(255,255,255,0.9); color: #9D56FF; padding-left: 20px;">
                        <i class="fas fa-search"></i>
                    </button>
                    <input class="form-control border-0" type="search" name="keyword" placeholder="Search topics..."
                        aria-label="Search" th:value="${param.keyword}"
                        style="background: rgba(255,255,255,0.9); box-shadow: none;" />
                </div>
            </form>

            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                <li class="nav-item" sec:authorize="isAnonymous()">
                    <a class="nav-link" th:href="@{/user/login}">
                        <button type="button" class="btn btn-sm btn-primary">Login</button>
                    </a>
                </li>
                <li class="nav-item" sec:authorize="isAnonymous()">
                    <a class="nav-link" th:href="@{/user/join}">
                        <button type="button" class="btn btn-sm btn-primary">SignUp</button>
                    </a>
                </li>

                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link px-2 text-black" th:href="@{/chat}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-chat-dots" viewBox="0 0 16 16">
                            <path
                                d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                            <path
                                d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9 9 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.4 10.4 0 0 1-.524 2.318l-.003.011a11 11 0 0 1-.244.637c-.079.186.074.394.273.362a22 22 0 0 0 .693-.125m.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6-3.004 6-7 6a8 8 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a11 11 0 0 0 .398-2" />
                        </svg>
                    </a>
                </li>

                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link px-2 text-black" th:href="@{/board/register}" title="글쓰기">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-plus-square" viewBox="0 0 16 16">
                            <path
                                d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z" />
                            <path
                                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                        </svg>
                        만들기
                        <i class="bi bi-file-plus fs-5"></i>
                    </a>
                </li>
                <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link dropdown-toggle text-black" id="navbarDropdown" href="#" role="button"
                        data-bs-toggle="dropdown">
                        <span th:text="${#authentication.principal.user.nickName}">사용자</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/user/modify}">Profile</a></li>
                        <li sec:authorize="hasAnyAuthority('ROLE_ADMIN')"><a class="dropdown-item"
                                th:href="@{/user/list}">User List</a></li>
                        <li>
                            <hr class="dropdown-divider" />
                        </li>
                        <li><a class="dropdown-item" id="logout" href="">Logout</a>
                            <form action="/user/logout" method="post" id="logoutForm"></form>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <script>
        document.getElementById("logout").addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('logoutForm').submit();
        });

        window.addEventListener('DOMContentLoaded', event => {
            document.addEventListener('click', function (e) {
                const toggleBtn = e.target.closest('#sidebarToggle');
                if (toggleBtn) {
                    e.preventDefault();
                    document.body.classList.toggle('sb-sidenav-toggled');
                    localStorage.setItem('sb|sidebar-toggle', document.body.classList.contains('sb-sidenav-toggled'));
                }
            });
            if (localStorage.getItem('sb|sidebar-toggle') === 'true') {
                document.body.classList.add('sb-sidenav-toggled');
            }
        });
    </script>
</nav>

</html>